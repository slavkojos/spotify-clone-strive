const albumData = {
  id: "915782",
  title: "Queen II (Deluxe Edition 2011 Remaster)",
  upc: "602527642499",
  link: "https://www.deezer.com/album/915782",
  share:
    "https://www.deezer.com/album/915782?utm_source=deezer&utm_content=album-915782&utm_term=0_1614883477&utm_medium=web",
  cover: "https://api.deezer.com/album/915782/image",
  cover_small: "https://e-cdns-images.dzcdn.net/images/cover/2b8899e10a2c8e7021b907697b2e5010/56x56-000000-80-0-0.jpg",
  cover_medium:
    "https://e-cdns-images.dzcdn.net/images/cover/2b8899e10a2c8e7021b907697b2e5010/250x250-000000-80-0-0.jpg",
  cover_big: "https://e-cdns-images.dzcdn.net/images/cover/2b8899e10a2c8e7021b907697b2e5010/500x500-000000-80-0-0.jpg",
  cover_xl: "https://e-cdns-images.dzcdn.net/images/cover/2b8899e10a2c8e7021b907697b2e5010/1000x1000-000000-80-0-0.jpg",
  md5_image: "2b8899e10a2c8e7021b907697b2e5010",
  genre_id: 152,
  genres: {
    data: [
      {
        id: 152,
        name: "Rock",
        picture: "https://api.deezer.com/genre/152/image",
        type: "genre",
      },
    ],
  },
  label: "EMI",
  nb_tracks: 16,
  duration: 3579,
  fans: 24264,
  rating: 0,
  release_date: "2011-03-14",
  record_type: "album",
  available: true,
  tracklist: "https://api.deezer.com/album/915782/tracks",
  explicit_lyrics: false,
  explicit_content_lyrics: 0,
  explicit_content_cover: 0,
  contributors: [
    {
      id: 412,
      name: "Queen",
      link: "https://www.deezer.com/artist/412",
      share:
        "https://www.deezer.com/artist/412?utm_source=deezer&utm_content=artist-412&utm_term=0_1614883477&utm_medium=web",
      picture: "https://api.deezer.com/artist/412/image",
      picture_small:
        "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/56x56-000000-80-0-0.jpg",
      picture_medium:
        "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/250x250-000000-80-0-0.jpg",
      picture_big:
        "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/500x500-000000-80-0-0.jpg",
      picture_xl:
        "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/1000x1000-000000-80-0-0.jpg",
      radio: true,
      tracklist: "https://api.deezer.com/artist/412/top?limit=50",
      type: "artist",
      role: "Main",
    },
  ],
  artist: {
    id: "412",
    name: "Queen",
    picture: "https://api.deezer.com/artist/412/image",
    picture_small:
      "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/56x56-000000-80-0-0.jpg",
    picture_medium:
      "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/250x250-000000-80-0-0.jpg",
    picture_big:
      "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/500x500-000000-80-0-0.jpg",
    picture_xl:
      "https://e-cdns-images.dzcdn.net/images/artist/0b17b99897d17ceb7027ed57cdbb7044/1000x1000-000000-80-0-0.jpg",
    tracklist: "https://api.deezer.com/artist/412/top?limit=50",
    type: "artist",
  },
  type: "album",
  tracks: {
    data: [
      {
        id: "9996961",
        readable: true,
        title: "Procession",
        title_short: "Procession",
        title_version: "",
        link: "https://www.deezer.com/track/9996961",
        duration: "73",
        rank: "205273",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-3.dzcdn.net/stream/c-3b11dbb6616dce3c9879804ed1171e51-18.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996962",
        readable: true,
        title: "Father To Son",
        title_short: "Father To Son",
        title_version: "",
        link: "https://www.deezer.com/track/9996962",
        duration: "373",
        rank: "223733",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-9.dzcdn.net/stream/c-90e13631740c58dc8694adeb514e7b84-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996963",
        readable: true,
        title: "White Queen (As It Began)",
        title_short: "White Queen (As It Began)",
        title_version: "",
        link: "https://www.deezer.com/track/9996963",
        duration: "273",
        rank: "243456",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-0.dzcdn.net/stream/c-02cdc15a97b4a8f89fd778e5ea523200-17.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996964",
        readable: true,
        title: "Some Day One Day",
        title_short: "Some Day One Day",
        title_version: "",
        link: "https://www.deezer.com/track/9996964",
        duration: "262",
        rank: "191979",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-9.dzcdn.net/stream/c-9cdc4620d8d64a661e1d61faad38d7ee-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996965",
        readable: true,
        title: "The Loser In The End",
        title_short: "The Loser In The End",
        title_version: "",
        link: "https://www.deezer.com/track/9996965",
        duration: "241",
        rank: "183388",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-6.dzcdn.net/stream/c-67ceb09c5f6e8b4e9db5eb5f06954457-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996966",
        readable: true,
        title: "Ogre Battle",
        title_short: "Ogre Battle",
        title_version: "",
        link: "https://www.deezer.com/track/9996966",
        duration: "248",
        rank: "220073",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-c.dzcdn.net/stream/c-c29a5c8829785e5430e6164387dc80c6-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996967",
        readable: true,
        title: "The Fairy Feller's Master-Stroke",
        title_short: "The Fairy Feller's Master-Stroke",
        title_version: "",
        link: "https://www.deezer.com/track/9996967",
        duration: "160",
        rank: "234770",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-b.dzcdn.net/stream/c-bb47a28f435238eb63fe61e56aaa8701-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996968",
        readable: true,
        title: "Nevermore",
        title_short: "Nevermore",
        title_version: "",
        link: "https://www.deezer.com/track/9996968",
        duration: "78",
        rank: "244114",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-3.dzcdn.net/stream/c-3815bb2553375ef180b58c4935446854-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996969",
        readable: true,
        title: "The March Of The Black Queen",
        title_short: "The March Of The Black Queen",
        title_version: "",
        link: "https://www.deezer.com/track/9996969",
        duration: "392",
        rank: "253610",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-b.dzcdn.net/stream/c-b4595c4705b6b062a1422549fc5e8196-17.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996970",
        readable: true,
        title: "Funny How Love Is",
        title_short: "Funny How Love Is",
        title_version: "",
        link: "https://www.deezer.com/track/9996970",
        duration: "169",
        rank: "189332",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-7.dzcdn.net/stream/c-7347e6b9e5fba4dff7f00cf9015c0029-18.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996971",
        readable: true,
        title: "Seven Seas Of Rhye",
        title_short: "Seven Seas Of Rhye",
        title_version: "",
        link: "https://www.deezer.com/track/9996971",
        duration: "169",
        rank: "313886",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-e.dzcdn.net/stream/c-e23edd3dd97f6860d0073b6024cef6f8-16.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996972",
        readable: true,
        title: "See What A Fool I've Been",
        title_short: "See What A Fool I've Been",
        title_version: "",
        link: "https://www.deezer.com/track/9996972",
        duration: "262",
        rank: "220901",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-b.dzcdn.net/stream/c-b32a98c50cbd1345933b2fcd196dfa0c-17.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996973",
        readable: true,
        title: "White Queen (As It Began)",
        title_short: "White Queen (As It Began)",
        title_version: "",
        link: "https://www.deezer.com/track/9996973",
        duration: "332",
        rank: "171297",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-e.dzcdn.net/stream/c-e2417c3daf3f6a721fb63079f4c2676b-17.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996974",
        readable: true,
        title: "Seven Seas Of Rhye",
        title_short: "Seven Seas Of Rhye",
        title_version: "",
        link: "https://www.deezer.com/track/9996974",
        duration: "189",
        rank: "154804",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-7.dzcdn.net/stream/c-73bde68974f0020e74dd9699548b175d-17.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996975",
        readable: true,
        title: "Nevermore",
        title_short: "Nevermore",
        title_version: "",
        link: "https://www.deezer.com/track/9996975",
        duration: "87",
        rank: "128515",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-5.dzcdn.net/stream/c-554bf3a61af82bb47a9573b88017b3b8-18.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
      {
        id: "9996976",
        readable: true,
        title: "See What A Fool I’ve Been",
        title_short: "See What A Fool I’ve Been",
        title_version: "",
        link: "https://www.deezer.com/track/9996976",
        duration: "271",
        rank: "137138",
        explicit_lyrics: false,
        explicit_content_lyrics: 0,
        explicit_content_cover: 0,
        preview: "https://cdns-preview-8.dzcdn.net/stream/c-820a6e1af69f2bb59764a747fbca49e6-17.mp3",
        md5_image: "2b8899e10a2c8e7021b907697b2e5010",
        artist: {
          id: "412",
          name: "Queen",
          tracklist: "https://api.deezer.com/artist/412/top?limit=50",
          type: "artist",
        },
        type: "track",
      },
    ],
  },
};

const playerSongName = document.getElementById("player-song-name");
const playButton = document.getElementById("play-button");
const pauseButton = document.getElementById("pause-button");
const prevTrack = document.getElementById("prev-track");
const nextTrack = document.getElementById("next-track");
const repeatButton = document.getElementById("repeat-button");
const shuffleButton = document.getElementById("shuffle-button");
const muteButton = document.getElementById("mute-button");
const unmuteButton = document.getElementById("unmute-button");
const currentTime = document.getElementById("current-time");
const totalTime = document.getElementById("total-time");
const seekSlider = document.getElementById("seek");
let currentTrack = document.createElement("audio");

currentTrack.src = albumData.tracks.data[0].preview;
currentTrack.load();
let isPlaying = false;
let trackIndex = 0;
let isRepeatOn = false;
let isShuffleOn = false;
let isMuteOn = false;
let updateTimer;

const playTrackButton = document.getElementsByClassName("song-id");
function pickTrack(event) {
  trackIndex = parseInt(event.target.innerHTML) - 1;
  loadTrack();
}

function loadTrack() {
  clearInterval(updateTimer);
  resetValues();
  for (let i = 0; i < playTrackButton.length; i++) {
    playTrackButton[i].classList.remove("now-playing");
  }
  playTrackButton[trackIndex].classList.add("now-playing");
  playerSongName.innerText = albumData.tracks.data[trackIndex].title;
  currentTrack.src = albumData.tracks.data[trackIndex].preview;
  currentTrack.load();
  currentTrack.addEventListener("loadedmetadata", function () {
    console.log(currentTrack.duration);
  });
  updateTimer = setInterval(seekUpdate, 500);
  setVolume();
  playTrack();
}

function playTrack() {
  if (isPlaying === false) {
    pauseButton.classList.toggle("d-none");
    playButton.classList.toggle("d-none");
  }
  isPlaying = true;
  currentTrack.play();
}

function pauseTrack() {
  currentTrack.pause();
  isPlaying = false;
  pauseButton.classList.toggle("d-none");
  playButton.classList.toggle("d-none");
}

function playNextTrack() {
  if (isPlaying === true && trackIndex < playTrackButton.length - 1) {
    trackIndex++;
    loadTrack();
  }
}

function playPrevTrack() {
  if (isPlaying === true && trackIndex > 0) {
    trackIndex--;
    loadTrack();
  }
}

for (let i = 0; i < playTrackButton.length; i++) {
  playTrackButton[i].addEventListener("click", pickTrack);
}
playButton.addEventListener("click", playpauseTrack);
pauseButton.addEventListener("click", playpauseTrack);
nextTrack.addEventListener("click", function () {
  if (isShuffleOn) {
    shuffleTrack();
  } else playNextTrack();
});
prevTrack.addEventListener("click", function () {
  if (isShuffleOn) {
    shuffleTrack();
  } else playPrevTrack();
});
repeatButton.addEventListener("click", function () {
  repeatButton.classList.toggle("active-button");
  isRepeatOn ^= true;
});
shuffleButton.addEventListener("click", function () {
  shuffleButton.classList.toggle("active-button");
  isShuffleOn ^= true;
});
muteButton.addEventListener("click", function () {
  isMuteOn = true;
  volumeSlider.value = 0;
  setVolume();
  muteButton.classList.toggle("d-none");
  unmuteButton.classList.toggle("d-none");
});
unmuteButton.addEventListener("click", function () {
  isMuteOn = false;
  volumeSlider.value = 50;
  setVolume();
  muteButton.classList.toggle("d-none");
  unmuteButton.classList.toggle("d-none");
});
currentTrack.addEventListener("ended", function () {
  if (isShuffleOn) {
    shuffleTrack();
  } else if (isRepeatOn) {
    playTrack();
  } else playNextTrack();
});
seekSlider.addEventListener("change", seekTo);

function playpauseTrack() {
  if (!isPlaying) playTrack();
  else pauseTrack();
}

function resetValues() {
  currentTime.textContent = "00:00";
  totalTime.textContent = "00:30";
  seekSlider.value = 0;
  seekSlider.style.background = `linear-gradient(90deg, rgba(29,185,84,1) 0%, rgba(83, 83, 83, 1) 0%)`;
}

function seekTo() {
  let seekto = currentTrack.duration * (seekSlider.value / 100);
  currentTrack.currentTime = seekto;
  seekSlider.value = Math.floor((currentTrack.currentTime / currentTrack.duration) * 100);
  seekSlider.style.background = `linear-gradient(90deg, rgba(29,185,84,1) ${seekSlider.value}%, rgba(83, 83, 83, 1) ${seekSlider.value}%)`;
}

let volumeSlider = document.getElementById("volume");
setVolume();
volumeSlider.addEventListener("input", setVolume);

function setVolume() {
  currentTrack.volume = volumeSlider.value / 100;
  volumeSlider.style.background = `linear-gradient(90deg, rgba(29,185,84,1) ${volumeSlider.value}%, rgba(83, 83, 83, 1) ${volumeSlider.value}%)`;
}

function shuffleTrack() {
  trackIndex = Math.floor(Math.random() * (playTrackButton.length - 1 - 0 + 1));
  loadTrack();
}

function seekUpdate() {
  let currentMinutes = Math.floor(currentTrack.currentTime / 60);
  let currentSeconds = Math.floor(currentTrack.currentTime - currentMinutes * 60);
  let durationMinutes = Math.floor(currentTrack.duration / 60);
  let durationSeconds = Math.floor(currentTrack.duration - durationMinutes * 60);
  if (currentSeconds < 10) {
    currentSeconds = "0" + currentSeconds;
  }
  if (durationSeconds < 10) {
    durationSeconds = "0" + durationSeconds;
  }
  if (currentMinutes < 10) {
    currentMinutes = "0" + currentMinutes;
  }
  if (durationMinutes < 10) {
    durationMinutes = "0" + durationMinutes;
  }
  seekSlider.value = Math.floor((currentTrack.currentTime / currentTrack.duration) * 100);
  seekSlider.style.background = `linear-gradient(90deg, rgba(29,185,84,1) ${seekSlider.value}%, rgba(83, 83, 83, 1) ${seekSlider.value}%)`;
  currentTime.textContent = currentMinutes + ":" + currentSeconds;
  totalTime.textContent = durationMinutes + ":" + durationSeconds;
}
